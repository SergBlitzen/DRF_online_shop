# Django online shop API

Онлайн-магазин с возможностью просматривать продукты, категории и корзину.

## Стек

* Python 3.10
* Django Rest Framework
* PostgreSQL
* Docker Compose
* nginx

## Возможности и эндпоинты

В проекте созданы модели:
* Категории
* Подкатегории
* Товары
* Изображения к товарам
* Корзина
* Товар в корзине

Каждый товар может быть связан с категорией или подкатегорией, а также иметь несколько изображений.

Создание сущностей (под)категорий, продуктов и пользователей происходит через админ-панель по адресу `/admin`,
для аутентификации пользователей используется токен, доступный по адресу `/api-token-auth/` с телом запроса:
```json
{
    "username": "User 1",
    "password": "password"
}
```
В результате успешной авторизации вернётся ответ с токеном:
```json
"token": "fc9e700ead2e9fb339311a23a5c59f23d738a2bc"
```

Доступ к товарам и (под)категориям происходит в режиме read-only, для чего используются следующие эндпоинты:
- `/api/v1/catigories/`
- `/api/v1/subcategories/`
- `/api/v1/products/`

Пример получения категории:
```json
{
    "count": 1,
    "next": null,
    "previous": null,
    "results": [
        {
            "id": 1,
            "name": "Category 1",
            "slug": "category1",
            "image": "http://127.0.0.1:8000/media/categories/test_image.jpg"
        }
    ]
}
```

Для товаров предусмотрена возможность добавления в корзину с помощью дополнительного POST-запроса `/api/v1/products/1/cart/`,
в результате которого появляется сущность корзины и товара в ней с указанным количеством. Пример POST-запроса:
```json
{
    "quantity": 10
}
```
При последующих POST-запросах на существующий в корзине товар количество в теле запроса будет складываться с уже существующим.

Также для изменения количества реализован PATCH-метод на этот же эндпоинт, который изменяет всё количество товара в корзине на указанное.

Для удаления товара из корзины на этот же эндпоинт нужно отправить DELETE-запрос.

Авторизованные пользователи также могут получить доступ к своей корзине по GET-запросу на эндпоинт `/api/v1/cart/`:
```json
{
    "products": [
        {
            "product": {
                "name": "Product 1",
                "price": 123.0
            },
            "quantity": 134
        }
    ],
    "full_price": 16482.0
}
```

DELETE-запрос к эндпоинту корзины полностью очищает её.

## Деплой проекта

Проект развёрнут в Docker-контейнерах с настроенной маршрутизацией через nginx.

Для деплоя проекта на сервере нужно выполнить следующие действия:
- создать в корне проекта файл `.env` и настроить переменные окружения в соответствии с файлом `.env.example`;
- запустить из корня docker compose:
```bash
docker compose up 
```
- применить миграции:
```bash
docker compose exec web python manage.py migrate
```
- собрать и скопировать статику:
```bash
docker compose exec web python manage.py collectstatic
docker compose exec web cp -r /app/collected_static/. /backend_static/static/
```
- создать суперпользователя для доступа в админку:
```bash
docker compose exec web python manage.py createsuperuser
```

## first_task.py

Отдельная программа для служебного назначения.

## Credits
Автор проекта: Serg Blitzen
